#### java中类加载：

##### 一、类加载的过程：

1、类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：

​	加载→验证→准备→解析→初始化→使用→卸载

2、其中**类加载过程**包括加载、验证、准备、解析、初始化，其中加载、验证、准备、初始化的发生顺序是确定的，而解析阶段则不确定，在某些情况下可以在初始化阶段之后开始。

​	**注意：**这几个阶段是按顺序开始的，而不是按顺序进行或完成。

​	1)、加载

​		在这个阶段主要完成三件事：a、通过一个类的全限定名来获取其定义的二进制字节流；

​							       b、将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构；

​							       c、在堆中生成一个代表这个类的Class对象，作为方法区中这些数据的访问入口。

​	2)、验证

​		主要是作用是确保被加载的类的正确性，主要完成四个阶段的验证：

​			a、文件格式的验证，包括魔数、主版本号、常量池等校验；

​			b、元数据验证：主要对字节码描述的信息进行语义分析，保证其描述的信息符合java语言规范要求；

​			c、字节码验证：通过数据流和控制流分析确定程序语义合法、符合逻辑，主要对类的方法做出分析；

​			d、符合引用验证：主要是对类自身以外的信息进行校验。目的是确保解析动作能够完成。

​		验证是一个很重要但是非必需的阶段，我们可以使用-Xverfity:none来关闭大部分的验证。

​	3)、准备

​		这个阶段主要为类变量分配内存并设置初始值。

​	4)、解析

​		解析阶段主要是虚拟机将常量池中的符号引用转化为直接引用的过程。

​	5)、初始化

​		在初始化阶段为类的静态变量赋予正确的初始值，jvm负责对类进行初始化，jvm初始化步骤：

​			a、假如这个类还没有被加载和连接，则程序先加载和连接该类；

​			b、假如该类的直接父类还没有被初始化，则先初始化其直接父类 ；

​			c、假如类中有初始化语句，则系统依次执行这些初始化语句。

##### 二、类加载器：													

1、java自带三个类加载器：

​	**a、Bootstrap ClassLoader启动类加载器：**最顶层的加载器，加载核心类库。

​	**b、Extention ClassLoader扩展类加载器 ：**扩展的类加载器，加载目录%JRE_HOME%\lib\ext目录下的jar包和class文件。

​	**c、Appclass Loader应用程序类加载器：**也称为SystemAppClass。 加载当前应用的classpath的所有类。

##### 三、类加载机制：

1、JVM类加载机制主要有3种：

​	**a、全盘负责：**当一个类加载器负责加载某个Class时，该Class所依赖和引用其他Class也将由该类加载器负责载入，除非显示使用另外一个类加载器来载入；

​	**b、双亲委派：**先让父类加载器试图加载该Class，只有在父类加载器无法加载该类时才尝试从自己的类路径中加载该类。这种机制可以防止类重复加载。

​	**c、缓存机制：**保证所有加载过的Class都会被缓存，当程序需要使用某个Class是，类加载器先从缓存区搜寻该Class，只有当缓存区不存在该Class时，才会加载，并存入缓存区，这就是为什么修改Class之后必须重新启动JVM。